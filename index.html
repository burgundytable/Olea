<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olea Education: Institutional DNA Calibration</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Gantari (Body) & Outfit (Display) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gantari:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        olea: {
                            base: '#f9f5ef',    // Cream Background
                            primary: '#123d07', // Deep Olive
                            secondary: '#4a6b41', // Lighter Olive
                            accent: '#d4b06a',  // Gold/Bronze accent
                            light: '#e3ebe3',
                            hover: '#0a2404',
                            text: '#1c1917'
                        }
                    },
                    fontFamily: {
                        sans: ['Gantari', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f9f5ef; color: #123d07; }
        
        /* DNA Bar Animation */
        .dna-bar { transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f9f5ef; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #123d07; border-radius: 10px; }
        
        /* Card Hover Effects */
        .school-card { transition: all 0.3s ease; }
        .school-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* DNA Pill Styles */
        .dna-pill { @apply px-2 py-0.5 rounded text-[10px] font-bold tracking-wider uppercase border; }
    </style>
</head>
<body class="min-h-screen flex flex-col antialiased selection:bg-olea-primary selection:text-white">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-olea-primary text-olea-base shadow-lg backdrop-blur-md bg-opacity-95">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-8 h-8 rounded-full border border-olea-base flex items-center justify-center">
                    <div class="w-2 h-2 bg-olea-base rounded-full"></div>
                </div>
                <div>
                    <h1 class="font-display font-bold text-xl tracking-tight leading-none">OLEA EDUCATION</h1>
                    <p class="text-[9px] uppercase tracking-[0.3em] opacity-70">Institutional DNA Calibration</p>
                </div>
            </div>
            <div class="hidden md:flex gap-6 text-sm font-medium tracking-wide">
                <a href="#" onclick="resetApp()" class="hover:text-olea-accent transition">The Archetypes</a>
                <a href="#" onclick="startQuiz()" class="hover:text-olea-accent transition">Diagnostic</a>
                <span class="opacity-30">|</span>
                <span id="user-code-display" class="font-mono text-olea-accent">GUEST</span>
            </div>
        </div>
    </nav>

    <!-- Hero / Control Panel -->
    <header class="bg-white/50 border-b border-olea-primary/5 py-12">
        <div class="container mx-auto px-6 max-w-6xl text-center">
            <h2 class="text-3xl md:text-5xl font-display font-bold text-olea-primary mb-4">Cultivating Eunoia</h2>
            <p class="text-lg text-stone-600 font-light max-w-2xl mx-auto mb-8">
                We utilize the <strong>Olea Archetype System™</strong> to decode the "Institutional DNA" of top universities. 
                Identify your 6-letter code to calculate the precise distance between your profile and your target school.
            </p>

            <div class="flex flex-wrap justify-center gap-4">
                <button onclick="startQuiz()" class="bg-olea-primary text-olea-base px-8 py-3 rounded-lg font-display font-bold shadow-xl hover:bg-olea-hover hover:scale-105 transition duration-300 flex items-center gap-2">
                    <i class="fas fa-fingerprint"></i> Calibrate My DNA
                </button>
                <button onclick="document.getElementById('directory-section').scrollIntoView({behavior:'smooth'})" class="bg-white text-olea-primary border border-olea-primary/20 px-8 py-3 rounded-lg font-display font-bold shadow-sm hover:bg-olea-light transition duration-300">
                    Browse Directory
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="directory-section" class="flex-grow container mx-auto px-6 py-12">
        
        <!-- Filter Bar -->
        <div class="flex flex-wrap justify-center gap-2 mb-10 text-sm">
            <span class="py-2 px-3 text-stone-400 font-bold uppercase text-xs tracking-widest flex items-center">Filter By Spike:</span>
            <button onclick="filterGrid('All')" class="filter-btn active px-4 py-2 rounded-full border border-olea-primary bg-olea-primary text-white transition">All</button>
            <button onclick="filterGrid('C')" class="filter-btn px-4 py-2 rounded-full border border-olea-primary/20 hover:bg-olea-primary/5 transition text-olea-primary">Conceptual (C)</button>
            <button onclick="filterGrid('A')" class="filter-btn px-4 py-2 rounded-full border border-olea-primary/20 hover:bg-olea-primary/5 transition text-olea-primary">Applied (A)</button>
            <button onclick="filterGrid('S')" class="filter-btn px-4 py-2 rounded-full border border-olea-primary/20 hover:bg-olea-primary/5 transition text-olea-primary">Solo (S)</button>
            <button onclick="filterGrid('K')" class="filter-btn px-4 py-2 rounded-full border border-olea-primary/20 hover:bg-olea-primary/5 transition text-olea-primary">Kinship (K)</button>
        </div>

        <!-- School Grid -->
        <div id="school-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Injected via JS -->
        </div>

    </main>

    <!-- MODAL: School Details -->
    <div id="school-modal" class="fixed inset-0 bg-olea-primary/60 backdrop-blur-md hidden z-[60] flex items-center justify-center p-4">
        <div class="bg-olea-base w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden relative fade-in">
            <button onclick="closeModal()" class="absolute top-4 right-4 z-10 text-stone-400 hover:text-olea-primary transition"><i class="fas fa-times fa-2x"></i></button>

            <!-- Sidebar: The DNA -->
            <div class="w-full md:w-1/3 bg-white border-r border-olea-primary/10 p-8 overflow-y-auto custom-scrollbar">
                <div class="mb-6">
                    <span id="modal-rank" class="bg-stone-100 text-stone-500 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">Rank #1</span>
                    <h2 id="modal-name" class="text-3xl font-display font-bold text-olea-primary mt-2 leading-none">School Name</h2>
                    <p id="modal-code" class="font-mono text-xl text-olea-accent mt-2 tracking-widest">XXXX-XX</p>
                </div>

                <!-- DNA Visualization -->
                <div class="space-y-4 mb-8">
                    <h3 class="text-xs font-bold text-stone-400 uppercase tracking-widest border-b border-stone-100 pb-2">Genetic Profile</h3>
                    
                    <!-- DNA Sliders (Generated via JS) -->
                    <div id="modal-dna-visuals" class="space-y-3"></div>
                </div>

                <div class="mt-auto">
                    <button id="modal-compare-btn" class="w-full py-3 border border-olea-primary text-olea-primary rounded-lg font-bold hover:bg-olea-primary hover:text-white transition uppercase text-xs tracking-widest">
                        Add to Comparison
                    </button>
                </div>
            </div>

            <!-- Content: The Narrative -->
            <div class="w-full md:w-2/3 p-8 md:p-12 overflow-y-auto custom-scrollbar bg-olea-base">
                <div class="mb-10">
                    <h4 class="text-xs font-bold text-olea-secondary uppercase tracking-widest mb-3">The Olea Persona</h4>
                    <p id="modal-persona" class="text-2xl md:text-3xl font-display font-medium text-olea-primary italic leading-tight">
                        "The Persona Description."
                    </p>
                </div>

                <div class="grid grid-cols-1 gap-8">
                    <div class="bg-white p-6 rounded-xl border border-olea-primary/5 shadow-sm">
                        <h4 class="text-sm font-bold text-olea-primary uppercase tracking-wide mb-3 flex items-center gap-2">
                            <i class="fas fa-chess-knight"></i> Strategic Translation
                        </h4>
                        <p id="modal-strategy" class="text-stone-700 leading-relaxed font-light">
                            Strategy goes here.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-xs font-bold text-stone-400 uppercase tracking-widest mb-3">Core Values</h4>
                            <ul id="modal-values" class="space-y-2 text-sm text-stone-600"></ul>
                        </div>
                        <div>
                            <h4 class="text-xs font-bold text-stone-400 uppercase tracking-widest mb-3">Evidence Markers</h4>
                            <ul id="modal-evidence" class="space-y-2 text-sm text-stone-600 font-mono text-xs"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Diagnostic Quiz -->
    <div id="quiz-modal" class="fixed inset-0 bg-olea-primary/95 hidden z-[70] flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-2xl">
            <!-- Header -->
            <div class="flex justify-between items-end mb-6 text-olea-base">
                <div>
                    <h2 class="text-3xl font-display font-bold">DNA Calibration</h2>
                    <p class="text-olea-light/60 text-sm mt-1">Forced-Choice Binary Assessment</p>
                </div>
                <div class="text-right">
                    <span id="quiz-step" class="text-4xl font-display font-bold text-olea-accent">1</span>
                    <span class="text-sm text-olea-light/40">/ 12</span>
                </div>
            </div>

            <!-- Card -->
            <div id="quiz-card" class="bg-olea-base rounded-2xl shadow-2xl p-8 md:p-12 relative overflow-hidden">
                <button onclick="closeQuiz()" class="absolute top-4 right-4 text-stone-300 hover:text-olea-primary"><i class="fas fa-times"></i></button>
                
                <div id="quiz-question-container" class="fade-in">
                    <h3 id="quiz-dimension" class="text-xs font-bold text-olea-secondary uppercase tracking-widest mb-4">Dimension: Mind</h3>
                    <p id="quiz-text" class="text-xl md:text-2xl font-display font-bold text-olea-primary mb-8 leading-snug">
                        Question Text
                    </p>

                    <div class="space-y-4">
                        <button onclick="handleAnswer(1)" class="w-full text-left p-5 rounded-xl border-2 border-stone-200 hover:border-olea-primary hover:bg-white transition group">
                            <div class="flex items-center justify-between">
                                <span id="opt-1-text" class="text-stone-700 font-medium group-hover:text-olea-primary text-lg">Option A</span>
                                <span class="w-6 h-6 rounded-full border-2 border-stone-300 group-hover:border-olea-primary"></span>
                            </div>
                        </button>
                        
                        <div class="text-center text-xs text-stone-400 font-bold uppercase my-2">- VS -</div>

                        <button onclick="handleAnswer(5)" class="w-full text-left p-5 rounded-xl border-2 border-stone-200 hover:border-olea-primary hover:bg-white transition group">
                            <div class="flex items-center justify-between">
                                <span id="opt-2-text" class="text-stone-700 font-medium group-hover:text-olea-primary text-lg">Option B</span>
                                <span class="w-6 h-6 rounded-full border-2 border-stone-300 group-hover:border-olea-primary"></span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Result View -->
                <div id="quiz-result-view" class="hidden text-center fade-in">
                    <div class="w-24 h-24 rounded-full bg-olea-primary text-olea-accent flex items-center justify-center mx-auto mb-6 text-4xl font-mono border-4 border-olea-accent">
                        <span id="result-code-final">CSFE</span>
                    </div>
                    <h3 class="text-2xl font-display font-bold text-olea-primary mb-2">Calibration Complete</h3>
                    <p id="result-archetype-name" class="text-lg text-olea-secondary font-medium italic mb-6">"The Philosopher King"</p>
                    <p class="text-stone-600 mb-8 max-w-md mx-auto">
                        Your strategic DNA has been mapped. We have filtered the university directory to highlight your "High Match" institutions and flag "Deadly Mismatches."
                    </p>
                    <button onclick="finalizeQuiz()" class="bg-olea-primary text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:bg-olea-hover transition">
                        View Strategic Matches
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Tray -->
    <div id="comparison-tray" class="fixed bottom-0 left-0 right-0 bg-white border-t-4 border-olea-primary shadow-[0_-10px_40px_rgba(0,0,0,0.1)] transform translate-y-full transition-transform duration-300 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-sm font-bold text-olea-primary flex items-center gap-2 uppercase tracking-wide">
                    <i class="fas fa-balance-scale"></i> Comparison
                </h3>
                <button onclick="toggleComparison()" class="text-stone-400 hover:text-olea-primary transition"><i class="fas fa-chevron-down"></i></button>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div id="slot-0" class="p-4 bg-stone-50 rounded border border-dashed border-stone-300 text-center text-xs text-stone-400">Empty Slot</div>
                <div id="slot-1" class="p-4 bg-stone-50 rounded border border-dashed border-stone-300 text-center text-xs text-stone-400">Empty Slot</div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA: THE INSTITUTIONAL DNA (Based on "The Answer Key") ---
        const universities = [
            // IVY LEAGUE
            { id: "princeton", name: "Princeton University", rank: 1, code: "CKFE-GU", persona: "The Conceptual Village", 
              desc: "Theoretical, tight-knit, open path, traditional. The ultimate 'Undergrad Grove'.",
              strategy: "Emphasize pure theory and the Senior Thesis. Avoid pre-professional talk.", 
              evidence: ["Senior Thesis Mandatory", "Eating Clubs", "No Med/Law/Biz Schools"] },
            { id: "harvard", name: "Harvard University", rank: 3, code: "ASFE-MR", persona: "The Applied Star", 
              desc: "Action-oriented, independent, flexible path, prestigious. A massive 'Research Metro'.",
              strategy: "Show massive scale of impact. You must be a 'Solo' leader who doesn't need hand-holding.", 
              evidence: ["Extension School", "Massive Endowment", "Cambridge City Integration"] },
            { id: "yale", name: "Yale University", rank: 5, code: "CKFE-GU", persona: "The Humanist Village", 
              desc: "Similar to Princeton but slightly more socially fluid. Traditional but supportive.",
              strategy: "Highlight 'Kinship' and the Residential Colleges. Be a humanist scholar.", 
              evidence: ["Residential Colleges", "Global Strategy", "Arts Focus"] },
            { id: "columbia", name: "Columbia University", rank: 12, code: "CSDE-MR", persona: "The Directed Intellectual", 
              desc: "Deeply theoretical (Core), solo/independent, very structured. NYC intensity.",
              strategy: "You must love the Core Curriculum (Western Canon) and the grit of NYC.", 
              evidence: ["The Core Curriculum", "NYC Location", "Butler Library Culture"] },
            { id: "penn", name: "UPenn", rank: 7, code: "ASDE-MR", persona: "The Pragmatic Operator", 
              desc: "Applied/Pre-professional, competitive, structured (Schools), traditional prestige.",
              strategy: "Connect theory to practice immediately. 'What is this knowledge FOR?'", 
              evidence: ["Wharton Influence", "One University Policy", "Pre-Professional Vibe"] },
            { id: "brown", name: "Brown University", rank: 13, code: "CKFV-GU", persona: "The Happy Architect", 
              desc: "Conceptual but creative, highly collaborative, the most fluid path, slightly visionary.",
              strategy: "Demonstrate ability to handle the Open Curriculum. Be 'Kinship' oriented.", 
              evidence: ["Open Curriculum", "S/NC Grading", "Happy Ivy"] },
            { id: "dartmouth", name: "Dartmouth College", rank: 12, code: "AKDE-GU", persona: "The Loyal Captain", 
              desc: "Applied/Active, intense kinship, somewhat directed (D-Plan), very traditional.",
              strategy: "Focus on the 'Grove' (Nature) and the D-Plan flexibility.", 
              evidence: ["D-Plan", "Hanover/Outdoors", "Greek Life Dominance"] },
            { id: "cornell", name: "Cornell University", rank: 17, code: "ASDE-GR", persona: "The Vocational Giant", 
              desc: "Applied, independent, structured (Colleges), traditional but research-heavy in a rural setting.",
              strategy: "Fit to Major/College is critical. Be 'Applied' and vocational.", 
              evidence: ["Distinct Colleges (Hotel, Ag)", "Gorges/Ithaca", "Any Person Any Study"] },

            // TECH & INNOVATION
            { id: "mit", name: "MIT", rank: 2, code: "AKDV-MR", persona: "The Collaborative Hacker", 
              desc: "Applied, surprisingly collaborative (Kinship via suffering), structured, visionary.",
              strategy: "Mens et Manus. Show you build things with others.", 
              evidence: ["Hacks", "P-Sets", "Mens et Manus"] },
            { id: "stanford", name: "Stanford University", rank: 3, code: "ASFV-GR", persona: "The Visionary Star", 
              desc: "Applied/Entrepreneurial, independent, fluid path. The ultimate visionary status.",
              strategy: "Intellectual Vitality + Innovation. Be 'Duck Syndrome' calm but elite.", 
              evidence: ["Silicon Valley", "D-School", "Start-up Culture"] },
            { id: "caltech", name: "Caltech", rank: 9, code: "CSDV-GR", persona: "The Pure Scientist", 
              desc: "Conceptual/Theory-heavy, solo/intense, highly directed, visionary science focus.",
              strategy: "Pure 'Conceptual' rigor. Honor code. No fluff.", 
              evidence: ["Honor Code", "House System", "Core Science"] },
            { id: "cmu", name: "Carnegie Mellon", rank: 22, code: "AKDV-MR", persona: "The Interdisciplinary Specialist", 
              desc: "Applied, kinship (within majors), directed, visionary maker culture.",
              strategy: "My heart is in the work. Specific interdisciplinary focus.", 
              evidence: ["SCS #1", "Drama/Arts", "Tartan Soul"] },

            // CHICAGO STYLE
            { id: "uchicago", name: "UChicago", rank: 6, code: "CSDE-MR", persona: "The Theory Fortress", 
              desc: "Conceptual, solo/debate-heavy, directed (Core), established prestige.",
              strategy: "Life of the Mind. Love the 'Why'. Weird essays.", 
              evidence: ["The Core", "Where Fun Comes to Die (Old)", "Scav Hunt"] },
            { id: "jhu", name: "Johns Hopkins", rank: 7, code: "ASDE-MR", persona: "The Research Specialist", 
              desc: "Applied/Medical, solo/independent, directed, research dominant.",
              strategy: "Research capability. Applied science focus.", 
              evidence: ["Research Spending #1", "Pre-Med Intensity", "Baltimore"] },
            { id: "northwestern", name: "Northwestern", rank: 10, code: "AKDE-MR", persona: "The Applied Communicator", 
              desc: "Applied, kinship/social, directed (Schools), established but modern.",
              strategy: "The 'AND' DNA. Journalism + Engineering. Communication is key.", 
              evidence: ["Quarter System", "Medill", "The Rock"] },
            
             // SOUTHERN & OTHERS
            { id: "duke", name: "Duke University", rank: 10, code: "AKDE-GR", persona: "The Spirited Leader", 
              desc: "Applied/Active, kinship (school spirit), directed, traditional campus bubble.",
              strategy: "Work hard play hard. Interdisciplinary 'Bass Connections'.", 
              evidence: ["Cameron Crazies", "Bass Connections", "Gothic Wonderland"] },
            { id: "vanderbilt", name: "Vanderbilt", rank: 13, code: "AKFE-MR", persona: "The Happy Balanced", 
              desc: "Applied, kinship (happiest students), fluid/social, metro-integrated.",
              strategy: "Balance. Happiness. The Commons living experience.", 
              evidence: ["The Commons", "Nashville", "Happiest Students"] },
            { id: "rice", name: "Rice University", rank: 15, code: "AKFV-MR", persona: "The Unconventional Village", 
              desc: "Applied, intense kinship (Colleges), fluid, visionary/quirky.",
              strategy: "Culture of Care. Residential College loyalty.", 
              evidence: ["Residential Colleges", "Unconventional Wisdom", "Houston"] },
            { id: "notredame", name: "Notre Dame", rank: 18, code: "CKDE-GU", persona: "The Faithful Steward", 
              desc: "Conceptual (Values), intense Kinship, Directed, Established. A true 'Grove'.",
              strategy: "A force for good. Values-based leadership.", 
              evidence: ["Dorm Life", "Fighting Irish", "Catholic Mission"] },
            
            // PUBLIC POWERHOUSES
            { id: "berkeley", name: "UC Berkeley", rank: 20, code: "ASFV-MR", persona: "The Radical Giant", 
              desc: "Applied/Activist, solo (sink or swim), fluid options, visionary/political.",
              strategy: "Scale and Grit. You must be a self-starter.", 
              evidence: ["Activism", "Scale", "Research Output"] },
            { id: "ucla", name: "UCLA", rank: 20, code: "AKFE-MR", persona: "The Optimistic Creative", 
              desc: "Applied, kinship (happier vibe than Cal), fluid, metro.",
              strategy: "Optimism and Impact. Creative capital.", 
              evidence: ["Applications #1", "Hollywood connection", "Bruin Spirit"] }
        ];

        // --- GLOBAL STATE ---
        let userCode = null; // e.g., "CSFE-MR"
        let userScores = {}; // Holds raw 1-5 scores
        let comparisonList = [null, null];

        // --- QUIZ DATA (12 Questions - Rapid Diagnostic) ---
        const quizQuestions = [
            // MIND (C vs A)
            { dim: "M", text: "What excites you more?", 
              left: "Writing a thesis on the history of AI ethics.", right: "Building an AI startup to solve a problem." },
            { dim: "M", text: "How do you view knowledge?", 
              left: "Knowledge is for understanding the 'Why'.", right: "Knowledge is a tool for the 'How'." },
            
            // SOCIAL (S vs K)
            { dim: "S", text: "In a group project...", 
              left: "I prefer to do it myself to ensure it's perfect.", right: "I prioritize the team's cohesion and morale." },
            { dim: "S", text: "Your ideal environment?", 
              left: "Competitive: I want to be the best.", right: "Collaborative: A rising tide lifts all boats." },

            // PATH (F vs D)
            { dim: "P", text: "Your academic roadmap?", 
              left: "Explore! I hate required courses.", right: "Direct me! I want a structured path to mastery." },
            { dim: "P", text: "Major selection?", 
              left: "I want to combine Poetry and Physics.", right: "I want to be in the Business School." },

            // SPIRIT (E vs V)
            { dim: "Sp", text: "Your career dream?", 
              left: "Partner at Goldman Sachs (Prestige).", right: "Founder of a disruptor (Innovation)." },
            { dim: "Sp", text: "What do you trust?", 
              left: "Tradition and History.", right: "Novelty and Disruption." },

            // ENV (M vs G)
            { dim: "E", text: "Where do you live?", 
              left: "The City is my campus (NYC/London).", right: "The Campus Bubble (The Quad/Green)." },
            
            // FOCUS (R vs U)
            { dim: "F", text: "Who comes first?", 
              left: "Research: I want massive labs/funding.", right: "Undergrad: I want teaching/mentorship." }
        ];

        let currentQIndex = 0;
        let quizResults = { M: 0, S: 0, P: 0, Sp: 0, E: 0, F: 0 }; // Accumulate scores

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderGrid(universities);
        });

        // --- RENDERING ---
        function renderGrid(data) {
            const grid = document.getElementById('school-grid');
            grid.innerHTML = '';

            data.forEach(school => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl p-6 border border-olea-primary/5 school-card cursor-pointer flex flex-col h-full";
                card.onclick = () => openModal(school);
                
                // Parse Code
                const [core, filter] = school.code.split('-');
                
                // Match Calculation (if user has code)
                let matchBadge = "";
                if(userCode) {
                    const matchScore = calculateMatch(userCode, school.code);
                    const matchColor = matchScore >= 5 ? "bg-green-100 text-green-800" : (matchScore >= 3 ? "bg-yellow-100 text-yellow-800" : "bg-red-100 text-red-800");
                    const matchText = matchScore >= 5 ? "High Match" : (matchScore >= 3 ? "Possible" : "Mismatch");
                    matchBadge = `<span class="px-2 py-1 rounded text-[10px] font-bold uppercase ${matchColor} ml-auto">${matchText}</span>`;
                }

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-[10px] font-bold text-stone-400 uppercase tracking-wider">Rank #${school.rank}</span>
                        ${matchBadge}
                    </div>
                    
                    <h3 class="text-xl font-display font-bold text-olea-primary mb-1">${school.name}</h3>
                    <p class="font-mono text-sm text-olea-accent tracking-widest mb-3">${school.code}</p>
                    
                    <p class="text-sm text-stone-600 italic font-light mb-4 flex-grow">"${school.persona}"</p>

                    <div class="border-t border-olea-primary/5 pt-4 mt-auto">
                        <div class="flex gap-1 flex-wrap">
                            ${generatePills(school.code)}
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function generatePills(code) {
            const map = {
                'C': 'Conceptual', 'A': 'Applied',
                'S': 'Solo', 'K': 'Kinship',
                'F': 'Fluid', 'D': 'Directed',
                'E': 'Established', 'V': 'Visionary',
                'M': 'Metro', 'G': 'Grove',
                'R': 'Research', 'U': 'Undergrad'
            };
            // Clean string
            const clean = code.replace('-', '');
            return clean.split('').map(char => 
                `<span class="dna-pill bg-olea-base text-olea-primary border-olea-primary/20">${map[char]}</span>`
            ).join('');
        }

        function filterGrid(type) {
            // Visual Toggle
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('bg-olea-primary', 'text-white');
                b.classList.add('text-olea-primary');
                if(b.innerText.includes(type) || (type === 'All' && b.innerText === 'All')) {
                    b.classList.add('bg-olea-primary', 'text-white');
                    b.classList.remove('text-olea-primary');
                }
            });

            if(type === 'All') {
                renderGrid(universities);
            } else {
                const filtered = universities.filter(u => u.code.includes(type));
                renderGrid(filtered);
            }
        }

        // --- MODAL LOGIC ---
        function openModal(school) {
            const m = document.getElementById('school-modal');
            m.classList.remove('hidden');
            m.classList.add('flex');

            document.getElementById('modal-name').innerText = school.name;
            document.getElementById('modal-rank').innerText = `Rank #${school.rank}`;
            document.getElementById('modal-code').innerText = school.code;
            document.getElementById('modal-persona').innerText = `"${school.persona}"`;
            document.getElementById('modal-strategy').innerText = school.strategy;
            
            // Evidence
            document.getElementById('modal-evidence').innerHTML = school.evidence.map(e => `<li>• ${e}</li>`).join('');
            
            // Values (Derived from Code)
            const valueMap = {
                'C': 'Values Theory & "Why"', 'A': 'Values Practice & "How"',
                'S': 'Values Independence', 'K': 'Values Community',
                'F': 'Values Exploration', 'D': 'Values Structure',
                'E': 'Values Tradition', 'V': 'Values Disruption',
                'M': 'City Integration', 'G': 'Campus Bubble',
                'R': 'Research Power', 'U': 'Student Focus'
            };
            const chars = school.code.replace('-','').split('');
            document.getElementById('modal-values').innerHTML = chars.map(c => `<li>${valueMap[c]}</li>`).join('');

            // DNA Visuals (Sliders)
            renderDNASliders(school.code);

            // Compare Btn
            const btn = document.getElementById('modal-compare-btn');
            btn.onclick = () => addToCompare(school);
        }

        function closeModal() {
            document.getElementById('school-modal').classList.add('hidden');
            document.getElementById('school-modal').classList.remove('flex');
        }

        function renderDNASliders(code) {
            const container = document.getElementById('modal-dna-visuals');
            container.innerHTML = '';
            
            const dims = [
                { l: 'Conceptual', r: 'Applied', k: ['C', 'A'] },
                { l: 'Solo', r: 'Kinship', k: ['S', 'K'] },
                { l: 'Fluid', r: 'Directed', k: ['F', 'D'] },
                { l: 'Established', r: 'Visionary', k: ['E', 'V'] },
                { l: 'Metro', r: 'Grove', k: ['M', 'G'] },
                { l: 'Research', r: 'Undergrad', k: ['R', 'U'] }
            ];

            dims.forEach(d => {
                // Check which side the code falls on
                const isLeft = code.includes(d.k[0]);
                const pos = isLeft ? '10%' : '90%'; // Simple binary visual for now
                
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="flex justify-between text-[10px] uppercase font-bold text-stone-400 mb-1">
                        <span class="${isLeft ? 'text-olea-primary' : ''}">${d.l}</span>
                        <span class="${!isLeft ? 'text-olea-primary' : ''}">${d.r}</span>
                    </div>
                    <div class="h-2 bg-stone-100 rounded-full relative overflow-hidden">
                        <div class="absolute top-0 bottom-0 w-1/2 bg-olea-primary/20 ${isLeft ? 'left-0' : 'right-0'}"></div>
                        <div class="absolute top-0 bottom-0 w-2 bg-olea-primary rounded-full transition-all duration-500" style="left: ${pos}"></div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- QUIZ LOGIC ---
        function startQuiz() {
            currentQIndex = 0;
            quizResults = { M: 0, S: 0, P: 0, Sp: 0, E: 0, F: 0 };
            document.getElementById('quiz-modal').classList.remove('hidden');
            document.getElementById('quiz-question-container').classList.remove('hidden');
            document.getElementById('quiz-result-view').classList.add('hidden');
            renderQuestion();
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').classList.add('hidden');
        }

        function renderQuestion() {
            const q = quizQuestions[currentQIndex];
            document.getElementById('quiz-step').innerText = currentQIndex + 1;
            
            // Map dim code to name
            const dimNames = { M: "The Mind", S: "The Social", P: "The Path", Sp: "The Spirit", E: "Environment", F: "Focus" };
            document.getElementById('quiz-dimension').innerText = `Dimension: ${dimNames[q.dim]}`;
            
            document.getElementById('quiz-text').innerText = q.text;
            document.getElementById('opt-1-text').innerText = q.left;
            document.getElementById('opt-2-text').innerText = q.right;
        }

        function handleAnswer(score) {
            const q = quizQuestions[currentQIndex];
            // Accumulate score (1=Left, 5=Right). 
            // Note: In questions array, Left is the First letter of pair (e.g. C), Right is Second (A).
            // Logic: Low score = Left Code, High score = Right Code.
            
            quizResults[q.dim] += score;
            
            currentQIndex++;
            if(currentQIndex < quizQuestions.length) {
                renderQuestion();
            } else {
                calculateResults();
            }
        }

        function calculateResults() {
            // Determine Code
            // M: Low=C, High=A (2 questions, max 10. Midpoint 6)
            // But E and F only have 1 question.
            
            const getChar = (dim, leftChar, rightChar, threshold) => {
                return quizResults[dim] > threshold ? rightChar : leftChar;
            };

            // Thresholds: 
            // 2 questions (max 10): > 6 is Right.
            // 1 question (max 5): > 3 is Right.
            
            let c1 = getChar('M', 'C', 'A', 6);
            let c2 = getChar('S', 'S', 'K', 6);
            let c3 = getChar('P', 'F', 'D', 6);
            let c4 = getChar('Sp', 'E', 'V', 6);
            let c5 = getChar('E', 'M', 'G', 3);
            let c6 = getChar('F', 'R', 'U', 3);

            userCode = `${c1}${c2}${c3}${c4}-${c5}${c6}`;
            
            // Show Result
            document.getElementById('quiz-question-container').classList.add('hidden');
            document.getElementById('quiz-result-view').classList.remove('hidden');
            document.getElementById('result-code-final').innerText = userCode;
            document.getElementById('user-code-display').innerText = userCode;
            
            // Assign Archetype Name
            const names = {
                'CSFE': 'The Philosopher King',
                'AKDV': 'The Happy Engineer',
                'CSDE': 'The Intellectual Warrior',
                'ASFE': 'The Applied Star',
                'CKFE': 'The Humanist'
                // Add more logic or generic fallback
            };
            const base = userCode.split('-')[0];
            document.getElementById('result-archetype-name').innerText = names[base] || "The Unique Strategist";
        }

        function finalizeQuiz() {
            closeQuiz();
            renderGrid(universities); // Re-render to show matches
        }

        function calculateMatch(student, school) {
            let score = 0;
            // Compare first 4
            for(let i=0; i<4; i++) if(student[i] === school[i]) score++;
            // Compare last 2 (indices 5,6 because of dash at 4)
            if(student[5] === school[5]) score++;
            if(student[6] === school[6]) score++;
            return score;
        }

        // --- COMPARISON TRAY ---
        function toggleComparison() {
            const t = document.getElementById('comparison-tray');
            t.classList.toggle('translate-y-full');
        }

        function addToCompare(school) {
            if(comparisonList[0] === null) comparisonList[0] = school;
            else comparisonList[1] = school;
            updateCompareUI();
            document.getElementById('comparison-tray').classList.remove('translate-y-full');
        }

        function updateCompareUI() {
            comparisonList.forEach((s, i) => {
                const el = document.getElementById(`slot-${i}`);
                if(s) {
                    el.innerHTML = `
                        <div class="flex justify-between font-bold text-olea-primary text-sm mb-1">
                            ${s.name} <button onclick="clearSlot(${i})" class="text-red-400 hover:text-red-600">x</button>
                        </div>
                        <div class="text-[10px] font-mono text-olea-accent">${s.code}</div>
                    `;
                    el.className = "p-3 bg-white border border-olea-primary/20 rounded shadow-sm text-left";
                } else {
                    el.innerHTML = "Empty Slot";
                    el.className = "p-4 bg-stone-50 rounded border border-dashed border-stone-300 text-center text-xs text-stone-400";
                }
            });
        }

        function clearSlot(i) {
            comparisonList[i] = null;
            updateCompareUI();
        }

        function resetApp() {
            userCode = null;
            document.getElementById('user-code-display').innerText = "GUEST";
            renderGrid(universities);
        }

    </script>
</body>
</html>
